"use strict";var myApp=angular.module("pearsonAngApp",["ngTouch","ui.bootstrap","ui.router"]);myApp.config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider",function(a,b,c){var d={encode:function(a){return a&&a.replace(/ /g,"-")},decode:function(a){return a&&a.replace(/-/g," ")},is:angular.isString,pattern:/[^/]+/};c.type("product",d),b.otherwise("/home"),a.state("home",{url:"/home",templateUrl:"views/main.html",controller:"MainCtrl"}).state("product",{url:"/{name:product}",templateUrl:"views/product.html",controller:"ProductCtrl",params:{jsonLocation:":jsonLocation",name:":name",date:":date"}}).state("product.lastDay",{url:"/Last_24_hrs",templateUrl:"views/product.lastDay.html",controller:"ProductCtrl"}).state("product.lastMonth",{url:"/Last_35_days",templateUrl:"views/product.lastMonth.html",controller:"ProductCtrl"})}]).directive("statusBoxes",function(){return{templateUrl:"views/status-boxes.html",restrict:"E"}}),angular.module("pearsonAngApp").controller("MainCtrl",["$scope","$http","statusColour","$location","selectDay","substractDate",function(a,b,c,d,e,f){a.lastupdated=[],a.dane=[],a.daty=[],a.setDay=function(a){e.addSelectedDay(a)},console.log(0===e.selectedDay().length),b.get("test-jsons/products.json").success(function(b){console.log("DATA pass"),a.lastupdated={hour:f.subs.hour(b.lastupdated),date:f.subs.date(b.lastupdated)},a.dane=b.products,a.daty=b.products[0].updates;for(var c=0;c<a.dane.length;c++)for(var d=0;d<a.dane[c].updates.length;d++)a.dane[c].updates[d].date={hour:f.subs.hour(a.dane[c].updates[d].date),date:f.subs.date(a.dane[c].updates[d].date)}}).error(function(){console.log("DATA failed")}),a.getStatus=function(a){return 2==a?"redProduct":1==a?"amberProduct":"greenProduct"}}]),angular.module("pearsonAngApp").controller("ProductCtrl",["$scope","$rootScope","$location","$http","$stateParams","statusColour","selectDay","modifyString","substractDate",function(a,b,c,d,e,f,g,h,i){a.productName=e.name,a.day=function(){return 0!==g.selectedDay().length?g.selectedDay():"past 30 days"},a.productData=[],a.selectedDate=[],a.prodNames=[],a.mainJSON=[],a.setDay=function(a){g.addSelectedDay(a)},a.lastDayUpdates=[],a.updateDaysList=function(b){g.addSelectedDay(b),a.day=function(){return g.selectedDay()},a.selectedDate=[],a.checker=!0;for(var c=0;c<a.productData.updates.length;c++)a.productData.updates[c].date.date===a.day()&&(a.selectedDate.push(a.productData.updates[c]),a.checker=!1);a.checker&&(a.selectedDate={prod:{date:{onlyDay:"",date:a.day(),hour:""},message:"No updates on that day"}})},d.get("test-jsons/products.json").success(function(b){a.mainJSON=b.products;for(var e=0;e<a.mainJSON.length;e++){var f=h.url.encode(a.mainJSON[e].name);a.prodNames.push(f),h.url.decode(a.mainJSON[e].name)}for(var j=c.path(),k=0;k<a.prodNames.length;k++){var l=a.prodNames[k];if(j.indexOf(l)>0)return d.get(a.mainJSON[k].url).success(function(b){console.log("sub JSON passed!"),a.productData=b,i.subs.fullDateObj(a.productData.updates),i.subs.fullDateObj(a.productData.rag_hrs),i.subs.fullDateObj(a.productData.rag_days),function(){for(var b=a.productData.rag_hrs.length-1,c=a.productData.updates,d=a.productData.rag_hrs,e=!0,f=0;f<a.productData.updates.length;f++)c[f].date.date==d[0].date.date&&(e=!1,a.lastDayUpdates.push(c[f]));e&&(a.lastDayUpdates={prod:{date:{onlyDay:d[b].date.onlyDay,date:d[b].date.date,hour:d[b].date.hour},message:"No updates within last 24 hours"}})}(),function(){if(0!==g.selectedDay().length){a.checker=!0;for(var b=0;b<a.productData.updates.length;b++)a.productData.updates[b].date.date==a.day()&&(a.selectedDate.push(a.productData.updates[b]),a.checker=!1);a.checker&&(a.selectedDate={prod:{date:{onlyDay:"",date:a.day(),hour:""},message:"No updates on that day"}})}else{a.checker=!1;for(var c=0;c<a.productData.updates.length;c++)a.selectedDate.push(a.productData.updates[c])}}(),a.productData.lastupdated={date:i.subs.date(a.productData.lastupdated),hour:i.subs.hour(a.productData.lastupdated)},angular.forEach(a.productData.rag_hrs,function(b,c){var d=a.productData.rag_hrs;return void 0==d[c+1]?!1:void(d[c].date.onlyDay!=d[c+1].date.onlyDay?(b.dayEnd=1,a.dayPrev=b.date.dateNoYear,a.dayNext=d[c+1].date.dateNoYear,b.date.nextDay=d[c+1].date.dateNoYear):b.dayEnd=!1)})}).error(function(){console.log("sub JSON failed")}),!1}}).error(function(){console.log("DATA failed")}),a.$on("$stateChangeSuccess",function(){a.currentPath=c.path().replace(/\//gi," > ").replace(/_|-/gi," ")}),a.getStatus=function(a){return f.list(a)}}]),myApp.service("statusColour",function(){this.list=function(a){function b(a){for(var b=0;b<a.length;b++)1===a[b].status?d=!0:2===a[b].status?e=!0:f=!0}var c,d=!1,e=!1,f=!1,g=[];return void 0!==a.updates?(g=a.updates,b(g)):(g=[],g.push(a),b(g)),c=e===!0?"redProduct":d===!0?"amberProduct":"greenProduct"}}),myApp.service("selectDay",function(){function a(a){return 0==a?(b=[],!1):(b.push(a),void(2==b.length&&b.shift()))}var b=[];return{addSelectedDay:a,selectedDay:function(){return String(b)}}}),myApp.service("modifyString",function(){var a={encode:function(a){return a&&a.replace(/ /g,"-")},decode:function(a){return a&&a.replace(/-/g," ")},is:angular.isString,pattern:/[^/]+/};return{url:a}}),myApp.service("substractDate",function(){var a=function(a,b,c){return String(new Date(a).toUTCString()).slice(b,c)},b={hour:function(b){return a(b,16,22)},date:function(b){return a(b,4,16)},dayName:function(b){return a(b,0,3)},dateNoYear:function(b){return a(b,4,11)},fullDateObj:function(a){for(var c=0;c<a.length;c++){var d=a[c].date;a[c].date={hour:b.hour(d),date:b.date(d),onlyDay:b.dayName(d),dateNoYear:b.dateNoYear(d)}}}};return{subs:b}});